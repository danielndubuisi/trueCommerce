import{g as c,a,l as n}from"./utils-DHPMa1J3.js";import{E as l}from"./ExternalServices-0hhErIEj.js";const u=new l;function h(s){return s.map(t=>({id:t.Id,price:t.FinalPrice*t.Quantity,name:t.Name,quantity:t.Quantity}))}function d(s){const e=new FormData(s),t={};return e.forEach((o,r)=>{t[r]=o}),t}class m{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=c(this.key)||[],this.calculateItemSubTotal()}calculateItemSubTotal(){let e=0,t=0;this.list.forEach(o=>{e+=o.FinalPrice*o.Quantity,t++}),this.itemTotal=e,document.querySelector("#cartTotal").textContent=`$${e.toFixed(2)}`,document.querySelector("#num-items").textContent=`${t}`}calculateOrderTotal(){this.tax=this.itemTotal*.06,this.shipping=10+(this.list.length-1)*2,this.orderTotal=parseFloat(this.itemTotal)+parseFloat(this.tax)+parseFloat(this.shipping),this.displayOrderTotals()}displayOrderTotals(){const e=document.querySelector(`${this.outputSelector} #tax`),t=document.querySelector(`${this.outputSelector} #shipping`),o=document.querySelector(`${this.outputSelector} #orderTotal`);e.innerText=`$${this.tax.toFixed(2)}`,t.innerText=`$${this.shipping.toFixed(2)}`,o.innerText=`$${this.orderTotal.toFixed(2)}`}async checkout(){var o;const e=document.forms.checkout,t=d(e);t.orderDate=new Date().toISOString(),t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=h(this.list);try{const r=await u.checkout(t);console.log("Checkout success:",r),localStorage.removeItem("so-cart"),window.location.href="/src/checkout/success.html"}catch(r){console.error("Checkout failed:",r),a(`Checkout failed: ${((o=r.message)==null?void 0:o.message)||JSON.stringify(r.message)}`)}}}n();function p(s){const e=document.querySelector(".checkout-form");if(!e)return;const t=document.createElement("div");t.classList.add("error-message"),t.innerHTML=`
    ${s}
    <span class="close-btn">&times;</span>
  `,t.querySelector(".close-btn").addEventListener("click",()=>{t.remove()}),e.prepend(t)}const i=new m("so-cart",".checkout-summary");i.init();document.querySelector("#zip").addEventListener("blur",i.calculateOrderTotal.bind(i));document.querySelector("#checkoutSubmit").addEventListener("click",s=>{s.preventDefault();const e=document.forms[0],t=e.checkValidity();e.reportValidity(),t?i.checkout():p("Please fix the errors in the form before submitting.")});
