import{g as c,a,l as n}from"./utils-as6mqNxt.js";/* empty css              */import{E as l}from"./ExternalServices-E0A9va82.js";const u=new l;function h(r){return r.map(t=>({id:t.id,price:t.price*t.quantity,name:t.title,quantity:t.quantity}))}function d(r){const e=new FormData(r),t={};return e.forEach((o,s)=>{t[s]=o}),t}class m{constructor(e,t){this.key=e,this.outputSelector=t,this.list=[],this.itemTotal=0,this.shipping=0,this.tax=0,this.orderTotal=0}init(){this.list=c(this.key)||[],this.calculateItemSubTotal()}calculateItemSubTotal(){let e=0,t=0;this.list.forEach(o=>{e+=o.price*o.quantity,t++}),this.itemTotal=e,this.calculateOrderTotal(),document.querySelector("#cartTotal").textContent=`$${e.toFixed(2)}`,document.querySelector("#num-items").textContent=`${t}`}calculateOrderTotal(){this.tax=this.itemTotal*.06,this.shipping=10+(this.list.length-1)*2,this.orderTotal=parseFloat(this.itemTotal)+parseFloat(this.tax)+parseFloat(this.shipping),this.displayOrderTotals()}displayOrderTotals(){const e=document.querySelector(`${this.outputSelector} #tax`),t=document.querySelector(`${this.outputSelector} #shipping`),o=document.querySelector(`${this.outputSelector} #orderTotal`);e.innerText=`$${this.tax.toFixed(2)}`,t.innerText=`$${this.orderTotal<700?this.shipping.toFixed(2):0}`,o.innerText=`$${this.orderTotal.toFixed(2)}`}async checkout(){var o;const e=document.forms.checkout,t=d(e);t.orderDate=new Date().toISOString(),t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=h(this.list);try{const s=await u.checkout(t);console.log("Checkout success:",s),localStorage.removeItem("so-cart"),window.location.href="../checkout/success.html"}catch(s){a(`Checkout failed: ${((o=s.message)==null?void 0:o.message)||JSON.stringify(s.message)}`,!1)}}}n();function p(r){const e=document.querySelector(".checkout-form");if(!e)return;const t=document.querySelector(".error-box");t.classList.add("error-message"),t.innerHTML=`
    ${r}
    <span class="close-btn">&times;</span>
  `,t.querySelector(".close-btn").addEventListener("click",()=>{t.remove()}),e.prepend(t)}const i=new m("so-cart",".checkout-summary");i.init();document.querySelector("#zip").addEventListener("blur",i.calculateOrderTotal.bind(i));document.querySelector("#checkoutSubmit").addEventListener("click",r=>{r.preventDefault();const e=document.forms[0],t=e.checkValidity();e.reportValidity(),t?i.checkout():p("Please fix the errors in the form before submitting.")});
